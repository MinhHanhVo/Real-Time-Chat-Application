<!-- views/chat.ejs -->
<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <div class="chat-layout">
        <div class="sidebar">
            <div class="search-container">
                <input type="text" id="search_user" placeholder="T√¨m ki·∫øm ng∆∞·ªùi d√πng...">
                <button id="btn_search">T√¨m</button>
            </div>
            <div class="search-results">
                <!-- <h3>K·∫øt qu·∫£ t√¨m ki·∫øm</h3> -->
                <ul id="search_results"></ul>
            </div>
            <div class="friend-requests">
                <h3>L·ªùi m·ªùi k·∫øt b·∫°n</h3>
                <ul id="friend_requests"></ul>
            </div>
            <div class="group-section">
                <div class="group-header">
                    <h3>Nh√≥m</h3>
                    <button id="btn_create_group">T·∫°o nh√≥m</button>
                </div>
                <ul id="group_list"></ul>
            </div>
            <div class="tabs">
                <button class="tab active" onclick="showTab('friends')">B·∫°n b√®</button>
                <button class="tab" onclick="showTab('pending')">Tin nh·∫Øn ch·ªù</button>
            </div>
            <div id="friends" class="tab-content active">
                <ul id="friend_list"></ul>
            </div>
            <div id="pending" class="tab-content">
                <ul id="pending_list"></ul>
            </div>
            <div class="user-info">
                <span id="current_username"></span>
                <button id="btn_logout">ƒêƒÉng xu·∫•t</button>
            </div>
        </div>
        <div class="container">
            <div class="chat-header">
                <h2><span id="chat_with"></span></h2>
                <button id="btn_add_member" style="display: none;">Th√™m th√†nh vi√™n</button>
                <button id="btn_library" style="display: none;">Th∆∞ vi·ªán t√†i li·ªáu</button>
                <button id="btn_media" style="display: none;">File/·∫¢nh</button>
                <button id="btn_tasks" style="display: none;">Checklist c√¥ng vi·ªác</button>
                <button onclick="openWhiteboard()">M·ªü b·∫£ng tr·∫Øng</button>
            </div>
            <div class="welcome-message">
                <h3>B·∫Øt ƒë·∫ßu cu·ªôc tr√≤ chuy·ªán v·ªõi m·ªôt ng∆∞·ªùi b·∫°n ho·∫∑c nh√≥m</h3>
                <p>Ch·ªçn m·ªôt ng∆∞·ªùi b·∫°n ho·∫∑c nh√≥m t·ª´ danh s√°ch b√™n tr√°i ƒë·ªÉ b·∫Øt ƒë·∫ßu chat!</p>
            </div>
            <ul id="ul_message"></ul>
            <div class="container_send">
                <input type="text" id="ip_message" placeholder="Nh·∫≠p tin nh·∫Øn...">
                <div class="image-upload-container">
                    <label for="ip_file" class="btn_image">
                        <span>üìé</span>
                    </label>
                    <input type="file" id="ip_file" accept="image/*,.pdf,.doc,.docx,.zip" style="display: none;">
                    <span id="selected_file_name" class="selected-image-name"></span>
                </div>
                <button id="btn_send">G·ª≠i</button>
            </div>
        </div>
    </div>

    <!-- Modal t·∫°o nh√≥m -->
    <div id="createGroupModal" class="modal">
        <div class="modal-content">
            <h3>T·∫°o nh√≥m m·ªõi</h3>
            <input type="text" id="group_name" placeholder="T√™n nh√≥m">
            <div class="friend-checkboxes">
                <h4>Ch·ªçn b·∫°n b√®</h4>
                <ul id="friend_checkboxes"></ul>
            </div>
            <button id="btn_submit_create_group">T·∫°o nh√≥m</button>
            <span class="close" onclick="closeGroupModal()">√ó</span>
        </div>
    </div>

    <!-- Modal th√™m th√†nh vi√™n -->
    <div id="addMemberModal" class="modal">
        <div class="modal-content">
            <h3>Th√™m th√†nh vi√™n</h3>
            <div class="friend-checkboxes">
                <h4>Ch·ªçn b·∫°n b√®</h4>
                <ul id="add_member_checkboxes"></ul>
            </div>
            <button id="btn_submit_add_member">Th√™m</button>
            <span class="close" onclick="closeAddMemberModal()">√ó</span>
        </div>
    </div>

    <!-- Modal th∆∞ vi·ªán t√†i li·ªáu -->
    <div id="libraryModal" class="modal">
        <div class="modal-content">
            <h3>Th∆∞ vi·ªán t√†i li·ªáu</h3>
            <div class="upload-container">
                <label for="library_file" class="btn_upload">
                    <span>üì§ T·∫£i l√™n t√†i li·ªáu</span>
                </label>
                <input type="file" id="library_file" accept="image/*,.pdf,.doc,.docx,.zip" style="display: none;">
                <span id="library_file_name"></span>
            </div>
            <input type="text" id="search_library" placeholder="T√¨m ki·∫øm t√†i li·ªáu...">
            <ul id="library_files"></ul>
            <button onclick="closeLibraryModal()">ƒê√≥ng</button>
        </div>
    </div>

    <!-- Modal File/·∫¢nh -->
    <div id="mediaModal" class="modal">
        <div class="modal-content">
            <h3>File/·∫¢nh</h3>
            <input type="text" id="search_media" placeholder="T√¨m ki·∫øm file/·∫£nh...">
            <ul id="media_files"></ul>
            <button onclick="closeMediaModal()">ƒê√≥ng</button>
        </div>
    </div>

    <!-- Modal Checklist c√¥ng vi·ªác -->
    <div id="tasksModal" class="modal">
        <div class="modal-content">
            <h3>Checklist c√¥ng vi·ªác</h3>
            <div class="task-form">
                <input type="text" id="task_title" placeholder="Ti√™u ƒë·ªÅ c√¥ng vi·ªác...">
                <textarea id="task_description" placeholder="M√¥ t·∫£ c√¥ng vi·ªác..."></textarea>
                <button id="btn_add_task">Th√™m c√¥ng vi·ªác</button>
            </div>
            <input type="text" id="search_tasks" placeholder="T√¨m ki·∫øm c√¥ng vi·ªác...">
            <ul id="task_list"></ul>
            <button onclick="closeTasksModal()">ƒê√≥ng</button>
        </div>
    </div>

    <!-- Modal hi·ªÉn th·ªã ·∫£nh -->
    <div id="imageModal" class="modal">
        <span id="closeModal" class="close">√ó</span>
        <img id="modalImage" class="modal-content" src="" alt="H√¨nh ·∫£nh l·ªõn">
    </div>

    <!-- Modal b·∫£ng tr·∫Øng -->
    <div id="whiteboardModal" class="modal">
        <div class="modal-content" style="width: 80%; max-width: 800px;">
            <span class="close" onclick="closeWhiteboard()">&times;</span>
            <h3>B·∫£ng tr·∫Øng nh√≥m</h3>
            <div>
                <button onclick="setColor('black')">ƒêen</button>
                <button onclick="setColor('red')">ƒê·ªè</button>
                <button onclick="setColor('blue')">Xanh</button>
                <button onclick="clearCanvas()">X√≥a</button>
                <button onclick="saveWhiteboard()">L∆∞u ·∫£nh</button>
            </div>
            <canvas id="whiteboard" width="700" height="400"></canvas>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/client.js"></script>
    <script>
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`button[onclick="showTab('${tabId}')"]`).classList.add('active');

            if (tabId === 'pending') {
                loadPendingMessages();
            } else {
                loadFriends();
            }
        }
    </script>
</body>

</html>